<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | AckWest</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: rgba(255, 255, 255, 0.03);
            --bg-card-hover: rgba(255, 255, 255, 0.06);
            --border-color: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-muted: rgba(255, 255, 255, 0.4);
            --accent-1: #6366f1;
            --accent-2: #8b5cf6;
            --accent-3: #a855f7;
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --gradient-1: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            --gradient-2: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 40% 60%, rgba(168, 85, 247, 0.08) 0%, transparent 40%);
            animation: bgFloat 20s ease-in-out infinite;
        }

        @keyframes bgFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(2%, 2%) rotate(1deg); }
            66% { transform: translate(-1%, 1%) rotate(-1deg); }
        }

        /* Noise overlay */
        .noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* Main container */
        .app-container {
            position: relative;
            z-index: 2;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
            background: rgba(10, 10, 15, 0.8);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .logo-text {
            font-weight: 600;
            font-size: 1.25rem;
            letter-spacing: -0.02em;
        }

        .logo-version {
            font-size: 0.7rem;
            color: var(--text-muted);
            background: var(--bg-card);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .user-menu:hover {
            background: var(--bg-card-hover);
        }

        .header-right {
            position: relative;
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 0.5rem;
            min-width: 160px;
            display: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 200;
        }

        .user-dropdown.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 100%;
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            border-radius: 6px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: var(--bg-card-hover);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--gradient-1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.85rem;
        }

        /* Main content */
        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Step indicator */
        .steps-container {
            display: flex;
            justify-content: center;
            margin-bottom: 3rem;
        }

        .steps {
            display: flex;
            align-items: center;
            gap: 0;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            transition: all 0.3s;
        }

        .step.active .step-number {
            background: var(--gradient-1);
            border-color: transparent;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
        }

        .step.completed .step-number {
            background: var(--success);
            border-color: transparent;
        }

        .step-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
            transition: color 0.3s;
        }

        .step.active .step-label,
        .step.completed .step-label {
            color: var(--text-primary);
        }

        .step-connector {
            width: 60px;
            height: 2px;
            background: var(--border-color);
            margin: 0 0.5rem;
            transition: background 0.3s;
        }

        .step.completed + .step-connector,
        .step-connector.active {
            background: var(--accent-1);
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            backdrop-filter: blur(20px);
            overflow: hidden;
        }

        .card-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .card-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .card-body {
            padding: 2rem;
        }

        /* Transcript input */
        .transcript-area {
            width: 100%;
            min-height: 300px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--text-primary);
            resize: vertical;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .transcript-area:focus {
            outline: none;
            border-color: var(--accent-1);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .transcript-area::placeholder {
            color: var(--text-muted);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 500;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-card-hover);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }

        .btn-ghost:hover {
            color: var(--text-primary);
            background: var(--bg-card);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        /* Processing animation */
        .processing-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            text-align: center;
        }

        .processing-container.active {
            display: flex;
        }

        .processing-orb {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--gradient-1);
            position: relative;
            margin-bottom: 2rem;
            animation: orbPulse 2s ease-in-out infinite;
        }

        .processing-orb::before {
            content: '';
            position: absolute;
            inset: -10px;
            border-radius: 50%;
            background: var(--gradient-1);
            opacity: 0.3;
            animation: orbRing 2s ease-in-out infinite;
        }

        .processing-orb::after {
            content: '';
            position: absolute;
            inset: -20px;
            border-radius: 50%;
            background: var(--gradient-1);
            opacity: 0.15;
            animation: orbRing 2s ease-in-out infinite 0.3s;
        }

        @keyframes orbPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes orbRing {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.1); opacity: 0.1; }
        }

        .processing-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .processing-steps {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            text-align: left;
            margin-top: 1.5rem;
        }

        .processing-step {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-muted);
            font-size: 0.95rem;
            transition: color 0.3s;
        }

        .processing-step.active {
            color: var(--text-primary);
        }

        .processing-step.complete {
            color: var(--success);
        }

        .processing-step-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-color);
            border-top-color: var(--accent-1);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Extraction results */
        .extraction-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 900px) {
            .extraction-grid {
                grid-template-columns: 1fr;
            }
        }

        .extraction-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .extraction-card-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .extraction-value {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .extraction-input {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-family: inherit;
            font-size: 1rem;
            color: var(--text-primary);
            transition: border-color 0.2s;
        }

        .extraction-input:focus {
            outline: none;
            border-color: var(--accent-1);
        }

        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.875rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 50px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tag:hover {
            background: var(--bg-card-hover);
        }

        .tag.selected {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--accent-1);
        }

        .tag-remove {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-card);
            border-radius: 50%;
            font-size: 0.7rem;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .tag-remove:hover {
            opacity: 1;
        }

        /* Topics section */
        .topics-section {
            margin-top: 2rem;
        }

        .topics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .topics-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .topic-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .topic-card:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-1);
        }

        .topic-card.selected {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--accent-1);
        }

        .topic-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
            transition: all 0.2s;
        }

        .topic-card.selected .topic-checkbox {
            background: var(--accent-1);
            border-color: var(--accent-1);
        }

        .topic-content {
            flex: 1;
        }

        .topic-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .topic-meta {
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .topic-keyword {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            color: var(--accent-2);
        }

        .topic-type {
            padding: 0.2rem 0.5rem;
            background: var(--bg-card);
            border-radius: 4px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        /* Content preview */
        .preview-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
        }

        @media (max-width: 1100px) {
            .preview-container {
                grid-template-columns: 1fr;
            }
        }

        .preview-content {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            color: #1a1a1a;
            max-height: 600px;
            overflow-y: auto;
        }

        .preview-content h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            line-height: 1.3;
        }

        .preview-content h2 {
            font-size: 1.4rem;
            margin: 1.5rem 0 0.75rem;
            color: #333;
        }

        .preview-content p {
            margin-bottom: 1rem;
            line-height: 1.7;
            color: #444;
        }

        .preview-sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .seo-score-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .seo-score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .seo-score-title {
            font-weight: 600;
        }

        .seo-score-value {
            font-size: 2rem;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .seo-check {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            font-size: 0.9rem;
        }

        .seo-check-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .seo-check-icon.pass {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }

        .seo-check-icon.fail {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        /* Action buttons in sidebar */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-1);
        }

        .action-btn-icon {
            width: 36px;
            height: 36px;
            background: var(--bg-card);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Social preview */
        .social-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .social-tab {
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .social-tab.active {
            background: var(--accent-1);
            border-color: var(--accent-1);
        }

        .social-preview-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .social-preview-text {
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .social-hashtags {
            color: var(--accent-2);
            font-size: 0.9rem;
        }

        /* Login screen */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .login-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 3rem;
            width: 100%;
            max-width: 420px;
            backdrop-filter: blur(20px);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            color: var(--text-primary);
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success { border-left: 3px solid var(--success); }
        .toast.error { border-left: 3px solid var(--error); }

        /* Sections visibility */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Utility */
        .hidden { display: none !important; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .text-center { text-align: center; }
        .text-muted { color: var(--text-muted); }

        /* Full width card */
        .full-width-card {
            grid-column: 1 / -1;
        }

        /* Competitor section */
        .competitor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .competitor-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 1.25rem;
        }

        .competitor-name {
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .competitor-stat {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .competitor-stat-value {
            color: var(--text-primary);
            font-weight: 500;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
</head>
<body>
    <div class="bg-animation"></div>
    <div class="noise"></div>

    <div class="app-container">
        <!-- Login Section -->
        <section id="login-section" class="section active">
            <div class="login-container">
                <div class="login-card">
                    <div class="login-logo">
                        <div class="logo-icon" style="width: 60px; height: 60px; font-size: 1.5rem; margin: 0 auto;">M</div>
                    </div>
                    <h1 class="login-title">AckWest</h1>
                    <p class="login-subtitle">Marketing Dashboard</p>
                    
                    <form id="login-form">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" id="login-email" class="form-input" placeholder="you@example.com" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" id="login-password" autocomplete="current-password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                            Sign In
                        </button>
                    </form>
                    
                    <p class="text-center text-muted mt-3" style="font-size: 0.85rem;">
                        Powered by AckWest
                    </p>
                </div>
            </div>
        </section>

        <!-- Main Dashboard -->
        <section id="dashboard-section" class="section">
            <header class="header">
                <div class="logo">
                    <div class="logo-icon">K</div>
                    <span class="logo-text">AckWest</span>
                    <span class="logo-version">M+M</span>
                </div>
                <div class="header-right">
                    <div class="user-menu" id="user-menu" onclick="toggleUserMenu()">
                        <div class="user-avatar" id="user-avatar">A</div>
                        <span id="user-name">Admin</span>
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </div>
                    <div class="user-dropdown" id="user-dropdown">
                        <button class="dropdown-item" onclick="logout()">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/>
                            </svg>
                            Sign Out
                        </button>
                    </div>
                </div>
            </header>

            <main class="main-content">
                <!-- Steps indicator -->
                <div class="steps-container">
                    <div class="steps">
                        <div class="step active" data-step="1">
                            <div class="step-number">1</div>
                            <span class="step-label">Transcript</span>
                        </div>
                        <div class="step-connector"></div>
                        <div class="step" data-step="2">
                            <div class="step-number">2</div>
                            <span class="step-label">Extract</span>
                        </div>
                        <div class="step-connector"></div>
                        <div class="step" data-step="3">
                            <div class="step-number">3</div>
                            <span class="step-label">Review</span>
                        </div>
                        <div class="step-connector"></div>
                        <div class="step" data-step="4">
                            <div class="step-number">4</div>
                            <span class="step-label">Topics</span>
                        </div>
                        <div class="step-connector"></div>
                        <div class="step" data-step="5">
                            <div class="step-number">5</div>
                            <span class="step-label">Generate</span>
                        </div>
                        <div class="step-connector"></div>
                        <div class="step" data-step="6">
                            <div class="step-number">6</div>
                            <span class="step-label">Publish</span>
                        </div>
                    </div>
                </div>

                <!-- Step 1: Transcript Input -->
                <div id="step-1" class="step-content active">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Client Discovery Transcript</h2>
                            <p class="card-subtitle">Paste the transcript from your client interview. Our AI will extract business details, keywords, and content opportunities.</p>
                        </div>
                        <div class="card-body">
                            <textarea 
                                id="transcript-input" 
                                class="transcript-area" 
                                placeholder="Paste your client interview transcript here...

Example:
'Hi, thanks for meeting with us today. Can you tell me about your business?'

'Sure! We're ABC Roofing, we've been serving the Sarasota area for about 15 years now. My father started the company back in 2009, so we're family-owned and operated. We mainly do residential roof repair and replacement, but we also handle some commercial projects.

We're really known for our 24-hour emergency service - if there's a storm and someone's roof is leaking at 2am, we'll be there. That's something our competitors don't offer...'"></textarea>
                            
                            <div class="btn-group">
                                <button class="btn btn-primary" onclick="analyzeTranscript()">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <path d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                    </svg>
                                    Analyze Transcript
                                </button>
                                <button class="btn btn-secondary" onclick="loadSampleTranscript()">
                                    Load Sample
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Processing Animation -->
                <div id="step-2" class="step-content">
                    <div class="card">
                        <div class="card-body">
                            <div class="processing-container active">
                                <div class="processing-orb"></div>
                                <h3 class="processing-title">Analyzing Transcript</h3>
                                <p class="text-muted">Our AI is extracting business intelligence...</p>
                                
                                <div class="processing-steps">
                                    <div class="processing-step" id="proc-step-1">
                                        <div class="processing-step-icon"><div class="spinner"></div></div>
                                        <span>Extracting business details...</span>
                                    </div>
                                    <div class="processing-step" id="proc-step-2">
                                        <div class="processing-step-icon">‚óã</div>
                                        <span>Identifying keywords & competitors...</span>
                                    </div>
                                    <div class="processing-step" id="proc-step-3">
                                        <div class="processing-step-icon">‚óã</div>
                                        <span>Analyzing tone & USPs...</span>
                                    </div>
                                    <div class="processing-step" id="proc-step-4">
                                        <div class="processing-step-icon">‚óã</div>
                                        <span>Generating content topics...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Review Extracted Data -->
                <div id="step-3" class="step-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Review Extracted Information</h2>
                            <p class="card-subtitle">Verify and edit the details we extracted from the transcript.</p>
                        </div>
                        <div class="card-body">
                            <div class="extraction-grid">
                                <div class="extraction-card">
                                    <div class="extraction-card-title">
                                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                                        Business Name
                                    </div>
                                    <input type="text" class="extraction-input" id="ext-business-name" value="">
                                </div>
                                
                                <div class="extraction-card">
                                    <div class="extraction-card-title">
                                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
                                        Location
                                    </div>
                                    <input type="text" class="extraction-input" id="ext-location" value="">
                                </div>
                                
                                <div class="extraction-card">
                                    <div class="extraction-card-title">
                                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
                                        Industry
                                    </div>
                                    <input type="text" class="extraction-input" id="ext-industry" value="">
                                </div>
                                
                                <div class="extraction-card">
                                    <div class="extraction-card-title">
                                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                                        Phone
                                    </div>
                                    <input type="text" class="extraction-input" id="ext-phone" value="">
                                </div>
                                
                                <div class="extraction-card full-width-card">
                                    <div class="extraction-card-title">
                                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                                        Primary Keywords
                                    </div>
                                    <div class="tag-list" id="ext-keywords">
                                        <!-- Tags will be inserted here -->
                                    </div>
                                </div>
                                
                                <div class="extraction-card full-width-card">
                                    <div class="extraction-card-title">
                                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                                        Competitors
                                    </div>
                                    <div class="tag-list" id="ext-competitors">
                                        <!-- Tags will be inserted here -->
                                    </div>
                                </div>
                                
                                <div class="extraction-card full-width-card">
                                    <div class="extraction-card-title">
                                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>
                                        Unique Selling Points
                                    </div>
                                    <div class="tag-list" id="ext-usps">
                                        <!-- Tags will be inserted here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="btn-group">
                                <button class="btn btn-ghost" onclick="goToStep(1)">
                                    ‚Üê Back
                                </button>
                                <button class="btn btn-primary" onclick="saveAndContinue()">
                                    Save & Continue
                                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"/></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Topic Selection -->
                <div id="step-4" class="step-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Content Topics</h2>
                            <p class="card-subtitle">Select the topics you want to generate content for.</p>
                        </div>
                        <div class="card-body">
                            <div class="topics-section">
                                <div class="topics-header">
                                    <h3 class="topics-title">üìù Blog Posts</h3>
                                    <button class="btn btn-ghost" onclick="selectAllTopics('blog')">Select All</button>
                                </div>
                                <div id="blog-topics">
                                    <!-- Blog topics will be inserted here -->
                                </div>
                            </div>
                            
                            <div class="topics-section" style="margin-top: 2.5rem;">
                                <div class="topics-header">
                                    <h3 class="topics-title">üì± Social Posts</h3>
                                    <button class="btn btn-ghost" onclick="selectAllTopics('social')">Select All</button>
                                </div>
                                <div id="social-topics">
                                    <!-- Social topics will be inserted here -->
                                </div>
                            </div>
                            
                            <div class="btn-group">
                                <button class="btn btn-ghost" onclick="goToStep(3)">
                                    ‚Üê Back
                                </button>
                                <button class="btn btn-primary" onclick="generateContent()">
                                    Generate Selected Content
                                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Content Generation -->
                <div id="step-5" class="step-content">
                    <div class="card">
                        <div class="card-body">
                            <div class="processing-container active">
                                <div class="processing-orb"></div>
                                <h3 class="processing-title">Generating Content</h3>
                                <p class="text-muted">Creating SEO-optimized content...</p>
                                
                                <div class="processing-steps" id="generation-steps">
                                    <!-- Dynamic generation steps -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 6: Preview & Publish -->
                <div id="step-6" class="step-content">
                    <div class="preview-container">
                        <div class="card">
                            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h2 class="card-title" id="preview-title">Content Preview</h2>
                                    <p class="card-subtitle" id="preview-keyword">Target: keyword here</p>
                                </div>
                                <div class="social-tabs" id="content-tabs">
                                    <!-- Content tabs -->
                                </div>
                            </div>
                            <div class="card-body" style="padding: 0;">
                                <div class="preview-content" id="preview-content">
                                    <!-- Content preview -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="preview-sidebar">
                            <div class="seo-score-card">
                                <div class="seo-score-header">
                                    <span class="seo-score-title">SEO Score</span>
                                    <span class="seo-score-value" id="seo-score">--</span>
                                </div>
                                <div id="seo-checks">
                                    <!-- SEO checks -->
                                </div>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="action-btn" onclick="copyContent()">
                                    <div class="action-btn-icon">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                                    </div>
                                    <span>Copy HTML</span>
                                </button>
                                
                                <button class="action-btn" onclick="publishToWordPress()">
                                    <div class="action-btn-icon">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                                    </div>
                                    <span>Publish to WordPress</span>
                                </button>
                                
                                <button class="action-btn" onclick="generateSocialKit()">
                                    <div class="action-btn-icon">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
                                    </div>
                                    <span>Generate Social Kit</span>
                                </button>
                            </div>
                            
                            <div class="btn-group" style="flex-direction: column;">
                                <button class="btn btn-ghost" onclick="goToStep(4)" style="width: 100%;">
                                    ‚Üê Generate More Content
                                </button>
                                <button class="btn btn-primary" onclick="startNewClient()" style="width: 100%;">
                                    Start New Client
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </section>
    </div>

    <div class="toast-container" id="toast-container"></div>

    <script>
        // Debug logging - disabled in production
        const DEBUG = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        if (!DEBUG) { console.log = () => {}; console.error = () => {}; }
        
        // ============================================
        // MCP 3.0 Dashboard - Main Application
        // ============================================

        // State
        let authToken = localStorage.getItem('mcp_token') || '';
        let currentUser = null;
        let currentStep = 1;
        let extractedData = null;
        let currentClient = null;
        let selectedTopics = { blog: [], social: [] };
        let generatedContent = [];

        // API Configuration
        const API_BASE = window.location.origin + '/api';

        // ============================================
        // Authentication
        // ============================================

        async function login(email, password) {
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Login failed');
                }

                authToken = data.token;
                currentUser = data.user;
                localStorage.setItem('mcp_token', authToken);

                document.getElementById('user-name').textContent = currentUser.name;
                document.getElementById('user-avatar').textContent = currentUser.name.charAt(0).toUpperCase();

                showSection('dashboard-section');
                showToast('Welcome back, ' + currentUser.name, 'success');

            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        function logout() {
            authToken = '';
            currentUser = null;
            localStorage.removeItem('mcp_token');
            showSection('login-section');
            hideUserMenu();
            showToast('Signed out successfully', 'success');
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('user-dropdown');
            dropdown.classList.toggle('show');
        }

        function hideUserMenu() {
            const dropdown = document.getElementById('user-dropdown');
            dropdown.classList.remove('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const userMenu = document.getElementById('user-menu');
            const dropdown = document.getElementById('user-dropdown');
            if (userMenu && dropdown && !userMenu.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });

        // ============================================
        // API Helpers
        // ============================================

        async function apiCall(endpoint, method = 'GET', body = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                }
            };

            if (body) {
                options.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const data = await response.json();

                if (!response.ok) {
                    // Provide clearer error messages
                    let errorMsg = data.error || 'Request failed';
                    
                    if (response.status === 401) {
                        errorMsg = 'Session expired. Please login again.';
                        logout();
                    } else if (response.status === 403) {
                        errorMsg = 'You don\'t have permission to do that.';
                    } else if (errorMsg.includes('OpenAI') || errorMsg.includes('API key')) {
                        errorMsg = 'OpenAI API error. Check your API key in .env file.';
                    } else if (errorMsg.includes('rate limit')) {
                        errorMsg = 'Rate limited. Please wait a moment and try again.';
                    }
                    
                    throw new Error(errorMsg);
                }

                return data;
            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error('Cannot connect to server. Is it running?');
                }
                throw error;
            }
        }

        // ============================================
        // Step Navigation
        // ============================================

        function goToStep(step) {
            currentStep = step;
            
            // Update step indicators
            document.querySelectorAll('.step').forEach((el, idx) => {
                el.classList.remove('active', 'completed');
                if (idx + 1 < step) el.classList.add('completed');
                if (idx + 1 === step) el.classList.add('active');
            });

            document.querySelectorAll('.step-connector').forEach((el, idx) => {
                el.classList.toggle('active', idx + 1 < step);
            });

            // Show/hide step content
            document.querySelectorAll('.step-content').forEach(el => {
                el.classList.remove('active');
            });
            document.getElementById(`step-${step}`).classList.add('active');
        }

        // ============================================
        // Transcript Analysis
        // ============================================

        async function analyzeTranscript() {
            const transcript = document.getElementById('transcript-input').value.trim();

            if (!transcript) {
                showToast('Please enter a transcript', 'error');
                return;
            }

            if (transcript.length < 100) {
                showToast('Transcript seems too short. Please enter more content.', 'error');
                return;
            }

            // Move to processing step
            goToStep(2);

            // Animate processing steps
            const procSteps = ['proc-step-1', 'proc-step-2', 'proc-step-3', 'proc-step-4'];
            
            for (let i = 0; i < procSteps.length; i++) {
                await sleep(1500);
                
                // Complete current step
                const currentEl = document.getElementById(procSteps[i]);
                currentEl.classList.remove('active');
                currentEl.classList.add('complete');
                currentEl.querySelector('.processing-step-icon').innerHTML = '‚úì';

                // Activate next step
                if (i < procSteps.length - 1) {
                    const nextEl = document.getElementById(procSteps[i + 1]);
                    nextEl.classList.add('active');
                    nextEl.querySelector('.processing-step-icon').innerHTML = '<div class="spinner"></div>';
                }
            }

            try {
                // Call API
                const result = await apiCall('/intake/analyze', 'POST', { transcript });
                extractedData = result.extracted;

                // Populate extraction form
                populateExtractionForm(extractedData);

                // Move to review step
                await sleep(500);
                goToStep(3);

            } catch (error) {
                showToast('Analysis failed: ' + error.message, 'error');
                goToStep(1);
            }
        }

        function populateExtractionForm(data) {
            const business = data.business || {};
            const seo = data.seo || {};
            const content = data.content || {};

            document.getElementById('ext-business-name').value = business.name || '';
            document.getElementById('ext-location').value = business.location || '';
            document.getElementById('ext-industry').value = business.industry || '';
            document.getElementById('ext-phone').value = business.phone || '';

            // Keywords
            const keywordsContainer = document.getElementById('ext-keywords');
            keywordsContainer.innerHTML = '';
            (seo.primary_keywords || []).forEach(kw => {
                keywordsContainer.appendChild(createTag(kw, 'keywords'));
            });

            // Competitors
            const competitorsContainer = document.getElementById('ext-competitors');
            competitorsContainer.innerHTML = '';
            (seo.competitors || []).forEach(comp => {
                competitorsContainer.appendChild(createTag(comp, 'competitors'));
            });

            // USPs
            const uspsContainer = document.getElementById('ext-usps');
            uspsContainer.innerHTML = '';
            (content.usps || []).forEach(usp => {
                uspsContainer.appendChild(createTag(usp, 'usps'));
            });
        }

        function createTag(text, type) {
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.innerHTML = `
                ${text}
                <span class="tag-remove" onclick="removeTag(this, '${type}')">√ó</span>
            `;
            return tag;
        }

        function removeTag(el, type) {
            el.parentElement.remove();
        }

        // ============================================
        // Save & Create Client
        // ============================================

        async function saveAndContinue() {
            // Gather data from form
            const updatedData = {
                business: {
                    name: document.getElementById('ext-business-name').value,
                    location: document.getElementById('ext-location').value,
                    industry: document.getElementById('ext-industry').value,
                    phone: document.getElementById('ext-phone').value
                },
                seo: {
                    primary_keywords: getTagValues('ext-keywords'),
                    competitors: getTagValues('ext-competitors')
                },
                content: {
                    usps: getTagValues('ext-usps'),
                    tone: extractedData?.content?.tone || 'professional'
                },
                topics: extractedData?.topics || {}
            };

            try {
                // Create client
                const result = await apiCall('/intake/create-client', 'POST', { extracted: updatedData });
                currentClient = result.client;

                // Populate topics
                populateTopics(result.topics || extractedData?.topics || {});

                showToast('Client profile created!', 'success');
                goToStep(4);

            } catch (error) {
                showToast('Failed to save: ' + error.message, 'error');
            }
        }

        function getTagValues(containerId) {
            const container = document.getElementById(containerId);
            return Array.from(container.querySelectorAll('.tag')).map(tag => {
                return tag.textContent.replace('√ó', '').trim();
            });
        }

        // ============================================
        // Topics
        // ============================================

        function populateTopics(topics) {
            const blogContainer = document.getElementById('blog-topics');
            const socialContainer = document.getElementById('social-topics');

            blogContainer.innerHTML = '';
            socialContainer.innerHTML = '';

            (topics.blog_posts || []).forEach((topic, idx) => {
                blogContainer.appendChild(createTopicCard('blog', idx, topic));
            });

            (topics.social_posts || []).forEach((topic, idx) => {
                socialContainer.appendChild(createTopicCard('social', idx, topic));
            });
        }

        function createTopicCard(type, idx, topic) {
            const card = document.createElement('div');
            card.className = 'topic-card';
            card.dataset.type = type;
            card.dataset.idx = idx;
            card.onclick = () => toggleTopic(card, type, idx);

            if (type === 'blog') {
                card.innerHTML = `
                    <div class="topic-checkbox">
                        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>
                    </div>
                    <div class="topic-content">
                        <div class="topic-title">${topic.title}</div>
                        <div class="topic-meta">
                            <span class="topic-keyword">üéØ ${topic.keyword}</span>
                            <span class="topic-type">Blog</span>
                        </div>
                    </div>
                `;
            } else {
                const platforms = (topic.platforms || []).join(', ').toUpperCase();
                card.innerHTML = `
                    <div class="topic-checkbox">
                        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>
                    </div>
                    <div class="topic-content">
                        <div class="topic-title">${topic.topic}</div>
                        <div class="topic-meta">
                            <span class="topic-keyword">üì± ${platforms}</span>
                            <span class="topic-type">${topic.content_type || 'Post'}</span>
                        </div>
                    </div>
                `;
            }

            return card;
        }

        function toggleTopic(card, type, idx) {
            card.classList.toggle('selected');
            
            const isSelected = card.classList.contains('selected');
            
            if (isSelected) {
                selectedTopics[type].push(idx);
            } else {
                selectedTopics[type] = selectedTopics[type].filter(i => i !== idx);
            }
        }

        function selectAllTopics(type) {
            const container = document.getElementById(`${type}-topics`);
            const cards = container.querySelectorAll('.topic-card');
            
            const allSelected = Array.from(cards).every(c => c.classList.contains('selected'));
            
            cards.forEach((card, idx) => {
                if (allSelected) {
                    card.classList.remove('selected');
                    selectedTopics[type] = [];
                } else {
                    card.classList.add('selected');
                    if (!selectedTopics[type].includes(idx)) {
                        selectedTopics[type].push(idx);
                    }
                }
            });
        }

        // ============================================
        // Content Generation
        // ============================================

        async function generateContent() {
            if (selectedTopics.blog.length === 0 && selectedTopics.social.length === 0) {
                showToast('Please select at least one topic', 'error');
                return;
            }

            goToStep(5);

            const stepsContainer = document.getElementById('generation-steps');
            stepsContainer.innerHTML = '';

            generatedContent = [];

            // Generate blog posts
            for (const idx of selectedTopics.blog) {
                const topic = extractedData.topics.blog_posts[idx];
                
                const stepEl = document.createElement('div');
                stepEl.className = 'processing-step active';
                stepEl.innerHTML = `
                    <div class="processing-step-icon"><div class="spinner"></div></div>
                    <span>Generating: ${topic.title}</span>
                `;
                stepsContainer.appendChild(stepEl);

                try {
                    const result = await apiCall('/content/generate', 'POST', {
                        client_id: currentClient.id,
                        keyword: topic.keyword,
                        geo: currentClient.geo,
                        industry: currentClient.industry,
                        word_count: 1200,
                        include_faq: true
                    });

                    generatedContent.push({
                        type: 'blog',
                        topic,
                        content: result.content,
                        seo_score: result.seo_score,
                        html: result.html
                    });

                    stepEl.classList.remove('active');
                    stepEl.classList.add('complete');
                    stepEl.querySelector('.processing-step-icon').innerHTML = '‚úì';

                } catch (error) {
                    stepEl.innerHTML = `
                        <div class="processing-step-icon" style="color: var(--error);">‚úó</div>
                        <span>Failed: ${topic.title}</span>
                    `;
                }
            }

            // Show preview
            await sleep(500);
            showPreview(0);
            goToStep(6);
        }

        // ============================================
        // Preview & Publish
        // ============================================

        function showPreview(idx) {
            if (generatedContent.length === 0) return;

            const content = generatedContent[idx];
            
            document.getElementById('preview-title').textContent = content.content.title;
            document.getElementById('preview-keyword').textContent = `Target: ${content.topic.keyword}`;
            
            document.getElementById('preview-content').innerHTML = DOMPurify.sanitize(content.content.body || content.html);

            // SEO Score
            const scoreData = content.seo_score || {};
            document.getElementById('seo-score').textContent = scoreData.total || '--';

            const checksContainer = document.getElementById('seo-checks');
            checksContainer.innerHTML = '';

            const checks = scoreData.checks || {};
            const checkLabels = {
                'meta_title_present': 'Meta title present',
                'meta_description_present': 'Meta description present',
                'keyword_in_h1': 'Keyword in H1',
                'word_count_sufficient': 'Word count 1200+',
                'internal_links_sufficient': '3+ internal links',
                'has_faq': 'FAQ section included'
            };

            for (const [key, passed] of Object.entries(checks)) {
                const label = checkLabels[key] || key;
                const checkEl = document.createElement('div');
                checkEl.className = 'seo-check';
                checkEl.innerHTML = `
                    <div class="seo-check-icon ${passed ? 'pass' : 'fail'}">${passed ? '‚úì' : '‚úó'}</div>
                    <span>${label}</span>
                `;
                checksContainer.appendChild(checkEl);
            }

            // Tabs for multiple content
            const tabsContainer = document.getElementById('content-tabs');
            tabsContainer.innerHTML = '';
            
            generatedContent.forEach((c, i) => {
                const tab = document.createElement('button');
                tab.className = `social-tab ${i === idx ? 'active' : ''}`;
                tab.textContent = `#${i + 1}`;
                tab.onclick = () => showPreview(i);
                tabsContainer.appendChild(tab);
            });
        }

        function copyContent() {
            const content = document.getElementById('preview-content').innerHTML;
            navigator.clipboard.writeText(content);
            showToast('HTML copied to clipboard!', 'success');
        }

        async function publishToWordPress() {
            if (generatedContent.length === 0) return;

            const idx = 0; // Current preview index
            const content = generatedContent[idx];

            try {
                const result = await apiCall('/publish/wordpress', 'POST', {
                    content_id: content.content.id,
                    status: 'draft'
                });

                showToast('Published to WordPress as draft!', 'success');
            } catch (error) {
                showToast('Publish failed: ' + error.message, 'error');
            }
        }

        async function generateSocialKit() {
            if (!currentClient) return;

            try {
                showToast('Generating social kit...', 'success');
                
                const result = await apiCall('/social/kit', 'POST', {
                    client_id: currentClient.id,
                    content_id: generatedContent[0]?.content?.id,
                    custom_topic: generatedContent[0]?.topic?.title
                });

                showToast('Social kit generated!', 'success');
            } catch (error) {
                showToast('Failed: ' + error.message, 'error');
            }
        }

        function startNewClient() {
            // Reset state
            extractedData = null;
            currentClient = null;
            selectedTopics = { blog: [], social: [] };
            generatedContent = [];

            document.getElementById('transcript-input').value = '';
            goToStep(1);
        }

        // ============================================
        // UI Helpers
        // ============================================

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${type === 'success' ? '‚úì' : '‚úó'}</span>
                <span>${message}</span>
            `;
            container.appendChild(toast);

            setTimeout(() => toast.remove(), 4000);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function loadSampleTranscript() {
            document.getElementById('transcript-input').value = `Interview with ABC Roofing - Discovery Call

Interviewer: Thanks for taking the time to speak with us today. Can you start by telling me about your business?

John (Owner): Absolutely! We're ABC Roofing, and we've been serving the Sarasota area for about 15 years now. My father actually started the company back in 2009, so we're a true family-owned and operated business. That's something we're really proud of.

Interviewer: That's great. What services do you primarily offer?

John: Our bread and butter is residential roof repair and roof replacement. We handle everything from minor leak repairs to complete tear-offs and re-roofs. We also do some commercial work, but residential is probably 80% of our business. We service all of Sarasota County, plus Bradenton, Venice, and even go up to Lakewood Ranch.

Interviewer: What would you say sets you apart from other roofing companies in the area?

John: A few things, actually. First, we offer 24-hour emergency service. If there's a storm at 2am and someone's roof is leaking into their living room, we'll be there. Most of our competitors don't do that - they make you wait until Monday. Second, because we're family-owned, you're always dealing with someone who actually cares. I personally oversee every job. And third, we've been around long enough that we have relationships with all the major insurance companies. We help homeowners navigate the claims process, which can be really confusing for people.

Interviewer: Who are your main competitors?

John: The big ones are XYZ Roofing - they do a lot of advertising, you see their trucks everywhere. Also 123 Roofs, they've been around almost as long as us. And there's Tampa Bay Roofers who sometimes come down into our area.

Interviewer: What questions do your customers typically ask?

John: The big ones are always about cost - "How much does a new roof cost?" People also ask about how long a roof lasts, whether they should repair or replace, and a lot of questions about insurance coverage, especially after storms. We get a ton of calls after hurricane season.

Interviewer: What are you hoping to achieve with your marketing?

John: Honestly, we want to rank higher on Google. When someone searches "roof repair Sarasota" or "roofing company near me," we want to show up. We also want to build more trust online - maybe get more reviews, show off some of our work. We've been relying on word of mouth for years, but the younger generation, they're all searching online first.`;
        }

        // ============================================
        // Initialization
        // ============================================

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            await login(email, password);
        });

        // Check for existing token on load
        if (authToken) {
            // Validate token
            apiCall('/auth/me')
                .then(user => {
                    currentUser = user;
                    document.getElementById('user-name').textContent = user.name;
                    document.getElementById('user-avatar').textContent = user.name.charAt(0).toUpperCase();
                    showSection('dashboard-section');
                })
                .catch(() => {
                    logout();
                });
        }
    </script>
</body>
</html>
